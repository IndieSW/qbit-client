#C Language QBit Client

The C Language QBit Client is a library that allows communication with a QBit server using web sockets and the QBit JSON ASCII Connection (QJAC) protocol. For more information about QBit, see https://github.com/advantageous/qbit.

##Dependencies

libwebsockets - https://libwebsockets.org/  
uthash - https://troydhanson.github.io/uthash/

##Building libwebsockets

The build instructions included with libwebsockets are straightforward. I used:

    cd libwebsockets
    mkdir build
    mkdir install
    cd build
    cmake -DCMAKE_INSTALL_PREFIX:PATH=/path/to/install ..
    make
    make install

##Incorporating uthash

uthash does not include any separately compiled components and is incorporated by including uthash.h in the C client source.

##External Header Files

The C Language QBit Client includes the following header files in a number of source files:

    lws_config.h
    libwebsockets.h
    uthash.h

These files are a) generated by the libwebsockets build or b) included in the uthash distribution. Depending on the directory structure used, the relative paths to these files in the client library source files may have to be changed.

##Building the Library for OS X

On OS X, Xcode may be used to build the library by adding all of the source files to the project files list of an OS X Framework & Library/Library project. This will build a static library which may then be linked with an application.

##API

The API for the C Language QBit Client is completely defined in qbit-api.h. It is the only file required for usage of the library in an application.

##Basic Operation

###Main Event Loop

qbit-service.c contains the main libwebsockets event loop. It repeatedly calls the function **libwebsocket_service** with a timeout of one second. If any serviceable events occur during that time, the QBit protocol callback is invoked.

###Event Handling

Web socket event handling for the QBit protocol is included qbit-protocol.c. The callback function, **qbitCallback**, is invoked whenever a serviceable event is detected by the **libwebsocket_service** function. **qbitCallback** handles the

    LWS_CALLBACK_CLIENT_ESTABLISHED
    LWS_CALLBACK_CLIENT_CONNECTION_ERROR
    LWS_CALLBACK_WSI_DESTROY
    LWS_CALLBACK_CLIENT_WRITEABLE
    LWS_CALLBACK_CLIENT_RECEIVE
    LWS_CALLBACK_GET_THREAD_ID

events and ignores all others.

When LWS_CALLBACK_CLIENT_WRITEABLE events occur, the protocol handler attempts to transmit a batch of messages to the server. When LWS_CALLBACK_CLIENT_RECEIVE events occur, the handler invokes the registered application callback once for each message included in the received batch.
